{% extends 'base.html' %}  
{% block content %}
  {% include "dashboard/components/navbarmain.html" %}
  <div id="page-wrapper">
    <div class="row">
      <div class="col-lg-12">
        {% include 'messages/messages.html' %}
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <h1 class="page-header">Vendors</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class='panel-heading'>
            Data
          </div>
          <div class='panel-body'>
            <div class='dataTable_wrapper'>
              <table id="vendor" class="responsive table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                  <tr>
                    <th data-priority="-1"></th>
                    <th data-priority="0">ID</th>
                    <th data-priority="1">Name</th>
                    <th data-priority="2">Address</th>
                    <th data-priority="3">City</th>
                    <th data-priority="4">State</th>
                    <th data-priority="5">Zip</th>
                    <th data-priority="10">Description</th>
                    <th data-priority="6" >Website</th>
                    <th data-priority="7">Phone</th>
                    <th data-priority="8">Email</th>
                    <th data-priority="9">Date Joined</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  $.ajaxSetup({ 
    beforeSend: function(xhr, settings) {
      xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}")
    }
  })
  editor = new $.fn.dataTable.Editor({
    ajax: {
      create: {
        type: 'POST',
        url:  '/store/Vendor/create/',
        traditional: false,
        dataType : 'json'
      },
      edit: {
        type: 'PUT',
        url:  '/store/Vendor/edit/_id_/',
        headers: { 'X_METHODOVERRIDE': 'PUT' },
        traditional: false,
        dataType : 'json',
      },
      remove: {
        type: 'DELETE',
        url:  '/store/Vendor/delete/_id_/',
        headers : { 'X_METHODOVERRIDE' : 'DELETE' },
        traditional : false,
        dataType : 'json'
      }
    },
    table: '#vendor',
    idSrc : 'id',
    fields: [
      {
        label: "Name",
        name : "name",
      }, { 
        label: "Address",
        name : "address",
      }, {
        label: "City",
        name : "city",
      }, {
        label: "State",
        name : "state",
      }, {
        label: "Zipcode",
        name : "zip",
      }, {
        label: "Description",
        name : "description",
        type : 'textarea'
      }, {
        label: "Website",
        name : "website_url",
      }, {
        label: "Phone Number",
        name : "phone_number"
      }, {
        label: "Email",
        name : "email"
      }, {
        label: "Date Joined",
        name : "date_joined",
	type : "date"
      }
    ]
  });
  editor.on('preSubmit', function(e, data, action){
    var valueList = {};
    for (var index in data['data']){
      valueList[index] = data['data'][index]
    }
    delete data['data'];
    data['data'] = []
    var data_value;
    for (var index in valueList){
      data_value = valueList[index];
      data_value['id'] = index;
      data['data'].push(JSON.stringify(data_value));
    }
  });
  
  var vendor_table = $('#vendor').DataTable({
    dom: "Bfrtip",
    ajax: '/store/Vendor/',
    columns: [
      { 
        data : null,
        defaultContent: '',
        className : 'control',
        orderable: false
      },
      {
        data : "id",
      },
      { data : "name"},
      { data : "address"},
      { data : "city"},
      { data : "state"},
      { data : "zip"},
      { data : "description"},
      { data : "website_url"},
      { data : "phone_number"},
      { data : "email"},
      { data : "date_joined"}
    ],
    order: [ 1, 'asc' ],
    select : true, 
    buttons : [
      { 
        extend: "create",
        editor : editor
      },
      { 
        extend :"edit",
        editor : editor
      },
      { 
        extend: "remove",
        editor : editor
      }
    ]      
  });
    $("#address").select2({allowClear: true});
</script>
{% endblock %}
